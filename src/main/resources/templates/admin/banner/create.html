<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout/layout}"
      layout:fragment="content">
<body>

<main class="p-12">
    <div class="md:flex md:items-center md:justify-between mb-5 border-b border-gray-900/10 pb-5 dark:border-white/10">
        <div class="min-w-0 flex-1">
            <h2 class="text-2xl/7 font-bold text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight dark:text-white">배너 등록</h2>
        </div>
<!--        <div class="mt-4 flex md:mt-0 md:ml-4">-->
<!--            <button type="button" th:onclick="|location.href='@{/admin/notice}'|"  class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-xs inset-ring inset-ring-gray-300 hover:bg-gray-50 dark:bg-white/10 dark:text-white dark:shadow-none dark:inset-ring-white/5 dark:hover:bg-white/20">취소</button>-->
<!--            <button type="submit" class="ml-3 inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-indigo-700 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 dark:bg-indigo-500 dark:shadow-none dark:hover:bg-indigo-400 dark:focus-visible:outline-indigo-400">등록</button>-->
<!--        </div>-->
    </div>

    <form method="post" th:action="@{/admin/banner/create}" enctype="multipart/form-data" th:object="${bannerCreateDto}">
        <div class="space-y-12">
            <div class="border-b border-gray-900/10 pb-12 dark:border-white/10">
                <div class="grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
                    <!-- Link URL -->
                    <div class="col-span-6">
                        <label for="linkUrl" class="block text-sm/6 font-medium text-gray-900 dark:text-white">url</label>
                        <div class="mt-2">
                            <input id="linkUrl" type="text" th:field="*{linkUrl}" autocomplete="url" class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6 dark:bg-white/5 dark:text-white dark:outline-white/10 dark:placeholder:text-gray-500 dark:focus:outline-indigo-500" />
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="col-span-full">
                        <label for="description" class="block text-sm/6 font-medium text-gray-900 dark:text-white">설명문</label>
                        <div class="mt-2">
                            <textarea id="description" th:field="*{description}" rows="3" class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6 dark:bg-white/5 dark:text-white dark:outline-white/10 dark:placeholder:text-gray-500 dark:focus:outline-indigo-500"></textarea>
                        </div>
                    </div>

                    <!-- Start Date -->
                    <div class="sm:col-span-2">
                        <label for="startDate" class="block text-sm/6 font-medium text-gray-900 dark:text-white">배너 시작일</label>
                        <div class="mt-2">
                            <input type="date" id="startDate" th:field="*{startDate}"
                                   class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1
                               -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2
                               focus:outline-indigo-600 sm:text-sm/6 dark:bg-white/5 dark:text-white dark:outline-white/10
                               dark:placeholder:text-gray-500 dark:focus:outline-indigo-500">
                        </div>
                    </div>

                    <!-- End Date -->
                    <div class="sm:col-span-2">
                        <label for="endDate" class="block text-sm/6 font-medium text-gray-900 dark:text-white">배너 종료일</label>
                        <div class="mt-2">
                            <input type="date" id="endDate" th:field="*{endDate}"
                                   class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1
                               -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2
                               focus:outline-indigo-600 sm:text-sm/6 dark:bg-white/5 dark:text-white dark:outline-white/10
                               dark:placeholder:text-gray-500 dark:focus:outline-indigo-500">
                        </div>
                    </div>

                    <!-- Enabled Toggle -->
                    <div class="sm:col-span-2">
                        <label for="enabled" class="block text-sm/6 font-medium text-gray-900 dark:text-white">Enabled</label>
                        <div class="mt-2 py-1.5">
                            <div class="group relative inline-flex w-11 shrink-0 rounded-full bg-gray-200 p-0.5
                                    inset-ring inset-ring-gray-900/5 outline-offset-2 outline-indigo-600 transition-colors
                                    duration-200 ease-in-out has-checked:bg-indigo-600 has-focus-visible:outline-2 dark:bg-white/5
                                    dark:inset-ring-white/10 dark:outline-indigo-500 dark:has-checked:bg-indigo-500">
                                <span class="size-5 rounded-full bg-white shadow-xs ring-1 ring-gray-900/5 transition-transform duration-200 ease-in-out group-has-checked:translate-x-5"></span>
                                <input type="checkbox" id="enabled" th:field="*{enabled}" aria-label="Enable banner" class="absolute inset-0 appearance-none focus:outline-hidden" />
                            </div>
                        </div>
                    </div>

                    <!-- Display Order -->
<!--                    <div class="sm:col-span-3">-->
<!--                        <label for="displayOrder" class="block text-sm/6 font-medium text-gray-900 dark:text-white">Display Order</label>-->
<!--                        <div class="mt-2">-->
<!--                            <input type="number" id="displayOrder" th:field="*{displayOrder}"-->
<!--                                   class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1-->
<!--                               -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2-->
<!--                               focus:outline-indigo-600 sm:text-sm/6 dark:bg-white/5 dark:text-white dark:outline-white/10-->
<!--                               dark:placeholder:text-gray-500 dark:focus:outline-indigo-500">-->
<!--                        </div>-->
<!--                    </div>-->

                    <!-- Image Upload -->
                    <div class="col-span-full">
                        <label for="cover-photo" class="block text-sm/6 font-medium text-gray-900 dark:text-white">Banner Image</label>
                        <div id="drop-zone" class="mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10 dark:border-white/25 transition-colors">
                            <div class="text-center">
                                <!-- 기본 상태 (이미지 없을 때) -->
                                <div id="upload-prompt">
                                    <svg viewBox="0 0 24 24" fill="currentColor" data-slot="icon" aria-hidden="true" class="mx-auto size-12 text-gray-300 dark:text-gray-600">
                                        <path d="M1.5 6a2.25 2.25 0 0 1 2.25-2.25h16.5A2.25 2.25 0 0 1 22.5 6v12a2.25 2.25 0 0 1-2.25 2.25H3.75A2.25 2.25 0 0 1 1.5 18V6ZM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0 0 21 18v-1.94l-2.69-2.689a1.5 1.5 0 0 0-2.12 0l-.88.879.97.97a.75.75 0 1 1-1.06 1.06l-5.16-5.159a1.5 1.5 0 0 0-2.12 0L3 16.061Zm10.125-7.81a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Z" clip-rule="evenodd" fill-rule="evenodd" />
                                    </svg>
                                    <div class="mt-4 flex text-sm/6 text-gray-600 dark:text-gray-400">
                                        <label for="file-upload" class="relative cursor-pointer rounded-md bg-transparent font-semibold text-indigo-600 focus-within:outline-2 focus-within:outline-offset-2 focus-within:outline-indigo-600 hover:text-indigo-500 dark:text-indigo-400 dark:focus-within:outline-indigo-500 dark:hover:text-indigo-300">
                                            <span>Upload a file</span>
                                            <input id="file-upload" name="imageFile" type="file" accept="image/png,image/jpeg,image/gif" class="sr-only" />
                                        </label>
                                        <p class="pl-1">or drag and drop</p>
                                    </div>
                                    <p class="text-xs/5 text-gray-600 dark:text-gray-400">PNG, JPG, GIF up to 10MB</p>
                                </div>

                                <!-- 이미지 미리보기 (이미지 업로드 후) -->
                                <div id="image-preview" class="hidden">
                                    <img id="preview-img" src="" alt="Preview" class="max-h-64 mx-auto rounded-lg" />
                                    <button type="button" id="remove-image" class="mt-4 text-sm font-semibold text-red-600 hover:text-red-500 dark:text-red-400 dark:hover:text-red-300">
                                        Remove image
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- Hidden field for imageUrl -->
                        <input type="hidden" th:field="*{imageUrl}" id="imageUrl" />
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-6 flex items-center justify-end gap-x-6">
            <a th:href="@{/admin/banner}"
               class="text-sm/6 font-semibold text-gray-900 dark:text-white hover:text-gray-700 dark:hover:text-gray-300">
                취소
            </a>
            <button type="submit" class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 dark:bg-indigo-500 dark:shadow-none dark:focus-visible:outline-indigo-500">Save</button>
        </div>
    </form>
</main>
<script>
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-upload');
    const uploadPrompt = document.getElementById('upload-prompt');
    const imagePreview = document.getElementById('image-preview');
    const previewImg = document.getElementById('preview-img');
    const removeBtn = document.getElementById('remove-image');

    // 파일 검증
    function validateFile(file) {
        const validTypes = ['image/png', 'image/jpeg', 'image/gif'];
        const maxSize = 10 * 1024 * 1024; // 10MB

        if (!validTypes.includes(file.type)) {
            alert('PNG, JPG, GIF 파일만 업로드 가능합니다.');
            return false;
        }

        if (file.size > maxSize) {
            alert('파일 크기는 10MB를 초과할 수 없습니다.');
            return false;
        }

        return true;
    }

    // 이미지 표시
    function displayImage(file) {
        if (!validateFile(file)) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            previewImg.src = e.target.result;
            uploadPrompt.classList.add('hidden');
            imagePreview.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
    }

    // 파일 선택 (클릭)
    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            displayImage(file);
        }
    });

    // 드래그 오버
    dropZone.addEventListener('dragover', function(e) {
        e.preventDefault();
        dropZone.classList.add('border-indigo-600', 'bg-indigo-50', 'dark:bg-indigo-900/20');
    });

    // 드래그 떠남
    dropZone.addEventListener('dragleave', function(e) {
        e.preventDefault();
        dropZone.classList.remove('border-indigo-600', 'bg-indigo-50', 'dark:bg-indigo-900/20');
    });

    // 드롭
    dropZone.addEventListener('drop', function(e) {
        e.preventDefault();
        dropZone.classList.remove('border-indigo-600', 'bg-indigo-50', 'dark:bg-indigo-900/20');

        const file = e.dataTransfer.files[0];
        if (file) {
            // input에도 파일 설정
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file);
            fileInput.files = dataTransfer.files;

            displayImage(file);
        }
    });

    // 이미지 제거
    removeBtn.addEventListener('click', function() {
        fileInput.value = '';
        previewImg.src = '';
        imagePreview.classList.add('hidden');
        uploadPrompt.classList.remove('hidden');
    });
</script>
</body>
</html>